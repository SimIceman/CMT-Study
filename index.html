<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CMT Level 1 – Smart Study Tracker</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:20px;
  max-width:1000px;
  margin:auto;
}

h1,h2 { text-align:center; }

.progress-box, .week {
  background:#fff;
  padding:15px;
  margin-bottom:15px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.progress-bar {
  height:20px;
  background:#ddd;
  border-radius:10px;
  overflow:hidden;
  margin-top:10px;
}

.progress-fill {
  height:100%;
  width:0%;
  background:#4CAF50;
  transition:width 0.4s;
}

.week.completed {
  background:#d4edda;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th, td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
  font-size:14px;
}

th { background:#f0f0f0; }
</style>
</head>

<body>

<h1>CMT Level 1 – Interactive Study Tracker</h1>
<h2>8 Hours / Week</h2>

<div class="progress-box">
  <strong>Overall Progress</strong>
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <p id="progressText">0% completed</p>
  <p id="timeStats"></p>
</div>

<div id="weeks"></div>

<script>
const topics = [
 "Intro & Philosophy of Technical Analysis",
 "Market Data & Chart Types",
 "Trend Analysis & Support/Resistance",
 "Chart Patterns",
 "Moving Averages",
 "Momentum Indicators",
 "Oscillators (RSI, MACD)",
 "Market Breadth & Sentiment",
 "Volatility & Cycles",
 "System Testing Basics",
 "Ethics",
 "Revision & Mock Exams"
];

let data = JSON.parse(localStorage.getItem("cmtTracker")) || {};

const weeksDiv = document.getElementById("weeks");

topics.forEach((topic, i) => {
  const w = document.createElement("div");
  w.className = "week";
  w.innerHTML = `
    <input type="checkbox" id="chk${i}">
    <strong>Week ${i+1}:</strong> ${topic}
    <table>
      <tr>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Days Taken</th>
      </tr>
      <tr>
        <td id="start${i}">-</td>
        <td id="end${i}">-</td>
        <td id="days${i}">-</td>
      </tr>
    </table>
  `;
  weeksDiv.appendChild(w);

  const checkbox = w.querySelector("input");

  if (data[i]?.completed) {
    checkbox.checked = true;
    w.classList.add("completed");
  }

  checkbox.addEventListener("change", () => toggleWeek(i, checkbox, w));
});

function toggleWeek(i, checkbox, w) {
  if (!data[i]) data[i] = {};

  if (checkbox.checked) {
    data[i].completed = true;
    data[i].end = new Date().toISOString();
    if (!data[i].start) data[i].start = new Date().toISOString();
    w.classList.add("completed");
  } else {
    data[i].completed = false;
    w.classList.remove("completed");
  }

  localStorage.setItem("cmtTracker", JSON.stringify(data));
  render();
}

function render() {
  let completed = 0;
  let totalDays = 0;

  topics.forEach((_, i) => {
    if (!data[i]) return;

    const start = data[i].start ? new Date(data[i].start) : null;
    const end = data[i].end ? new Date(data[i].end) : null;

    document.getElementById(`start${i}`).innerText = start ? start.toDateString() : "-";
    document.getElementById(`end${i}`).innerText = end ? end.toDateString() : "-";

    if (start && end) {
      const days = Math.ceil((end - start)/(1000*60*60*24));
      document.getElementById(`days${i}`).innerText = days;
      totalDays += days;
    }

    if (data[i].completed) completed++;
  });

  const percent = Math.round((completed / topics.length) * 100);
  document.getElementById("progressFill").style.width = percent + "%";
  document.getElementById("progressText").innerText = `${percent}% completed`;
  document.getElementById("timeStats").innerText =
    `Topics completed: ${completed}/${topics.length} | Total days spent: ${totalDays}`;
}

render();
</script>

</body>
</html>
